<?xml version = "1.0"?>
<robot name ="unodopo" xmlns:xacro="http://ros.org/wiki/xacro">

    <material name = "blue">
        <color rgba="0 0 0.8 1"/>
    </material>

    <material name = "white">
        <color rgba="1 1 1 1"/>
    </material>

    <xacro:property name="base_width" value="0.44" /> 
    <xacro:property name="base_height" value="0.3" /> 
    <xacro:property name="base_depth" value="0.62" /> <!-- in m-->
    <xacro:property name="base_mass" value="5" /> <!-- in kg-->

    <xacro:property name="wheel_radius" value="0.155" /> 
    <xacro:property name="wheel_mass" value="2.5" /> <!-- in kg-->
    <xacro:property name="wheel_height" value="0.05"/>

    <xacro:property name="wheel_offset" value="0.06779" /> <!--wheeloffset-->
   
      <!-- Macro for calculating inertia of cylinder -->
    <xacro:macro name="cylinder_inertia" params="m r h">
        <inertia ixx="${m*(3*r*r+h*h)/12}" ixy = "0" ixz = "0"
                iyy="${m*(3*r*r+h*h)/12}" iyz = "0"
                izz="${m*r*r/2}" /> 
    </xacro:macro>

    <xacro:macro name="cuboid_inertia" params="m w h d">
        <inertia ixx="${m*(h*h+d*d)/12}" ixy = "0" ixz = "0"
                iyy="${m*(w*w+d*d)/12}" iyz = "0"
                izz="${m*(w*w+h*h)/12}" /> 
    </xacro:macro>

    <link name = "base_link">
        <visual>
            <geometry>
               <mesh filename="package://unodopo/meshes/unodopo_body.stl" scale="0.001 0.001 0.001"/> <!-- converting from mm to m--> 
            </geometry>
            <origin xyz="0 0 -${wheel_offset}"/>
            <material name ="blue"/> <!-- for rviz-->
        </visual>
        <collision>
            <geometry>
               <mesh filename="package://unodopo/meshes/unodopo_body.stl" scale="0.001 0.001 0.001"/> 
            </geometry>
            <origin uboidxyz="0 0 -${wheel_offset}"/>
        </collision>
        <inertial>
            <mass value="${base_mass}" />
            <origin xyz="0 0 -${wheel_offset}"/>
            <xacro:cuboid_inertia m="${base_mass}" w="${base_width}" h="${base_height}" d="${base_depth}"/>
        </inertial>
    </link>
    <gazebo reference="base_link">
        <material>Gazebo/Orange</material>
    </gazebo>

    <link name ="right_wheel">
        <visual>
            <geometry>
               <mesh filename="package://unodopo/meshes/unodopo_right_wheel.stl" scale="0.001 0.001 0.001"/> 
            </geometry>
            <origin xyz="0 0 -${wheel_offset}"/>
            <material name="white"/>
        </visual>
        <collision>
            <geometry>
               <mesh filename="package://unodopo/meshes/unodopo_right_wheel.stl" scale="0.001 0.001 0.001"/> 
            </geometry>
            <origin xyz="0 0 -${wheel_offset}"/>
        </collision>
        <inertial>
            <mass value="${wheel_mass}"/>
            <origin xyz="0 0 -${wheel_offset}"/>
            <xacro:cylinder_inertia m="${wheel_mass}" r="${wheel_radius}" h="${wheel_height}"/>
        </inertial>
    </link>
    <gazebo reference="right_wheel">
        <material>Gazebo/White</material>
    </gazebo>

    <joint name="right_wheel_joint" type ="continuous">
        <parent link ="base_link"/>
        <child link="right_wheel"/>
        <origin xyz="0 0 0"/>
        <axis xyz="0 1 0"/>
    </joint>

    <link name="left_wheel">
        <visual>
            <geometry>
               <mesh filename="package://unodopo/meshes/unodopo_left_wheel.stl" scale="0.001 0.001 0.001"/> 
            </geometry>
            <origin xyz="0 0 -${wheel_offset}"/>}"/>
            <material name="white"/>
        </visual>
        <collision>
            <geometry>
               <mesh filename="package://unodopo/meshes/unodopo_left_wheel.stl" scale="0.001 0.001 0.001"/> 
            </geometry>
            <origin xyz="0 0 -${wheel_offset}"/>
        </collision>
        <inertial>
            <mass value="${wheel_mass}"/>
            <origin xyz="0 0 -${wheel_offset}"/>
            <xacro:cylinder_inertia m="${wheel_mass}" r="${wheel_radius}" h="${wheel_height}"/>
        </inertial>
    </link>
    <gazebo reference="left_wheel">
        <material>Gazebo/White</material>
    </gazebo>

    <joint name="left_wheel_joint" type="continuous">
       <parent link="base_link"/> 
       <child link="left_wheel"/>
       <origin xyz="0 0 0"/>
       <axis xyz="0 1 0"/>
    </joint>
</robot>